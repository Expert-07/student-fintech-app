{"version":3,"file":"Timetable-0Xyed43L.js","sources":["../../src/pages/Timetable.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\n\r\nconst daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];\r\nconst timeSlots = [\r\n  '07:00', '08:00', '09:00', '10:00', '11:00', '12:00',\r\n  '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'\r\n];\r\n\r\nconst Timetable = () => {\r\n  const [timetable, setTimetable] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [uploadError, setUploadError] = useState(\"\");\r\n  const fileInputRef = useRef();\r\n  // Handle PDF upload\r\n  const handlePDFUpload = async (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n    if (file.type !== \"application/pdf\") {\r\n      setUploadError(\"Only PDF files are allowed.\");\r\n      return;\r\n    }\r\n    setUploading(true);\r\n    setUploadError(\"\");\r\n    const token = localStorage.getItem(\"token\");\r\n    const userId = localStorage.getItem(\"userId\");\r\n    const formData = new FormData();\r\n    formData.append(\"pdf\", file);\r\n    formData.append(\"userId\", userId);\r\n    try {\r\n      const res = await fetch(\"http://localhost:5000/api/timetable/upload\", {\r\n        method: \"POST\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        body: formData,\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.message || \"Upload failed\");\r\n      alert(\"PDF uploaded successfully!\");\r\n      // Optionally, refresh timetable or show link\r\n    } catch (err) {\r\n      setUploadError(err.message);\r\n    } finally {\r\n      setUploading(false);\r\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n    }\r\n  };\r\n\r\n  // Handle clearing the file input and error\r\n  const handleClearFileInput = () => {\r\n    if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n    setUploadError(\"\");\r\n  };\r\n\r\n  // Move fetchTimetable outside useEffect\r\n  const fetchTimetable = async () => {\r\n    setLoading(true);\r\n    const token = localStorage.getItem('token');\r\n    const userId = localStorage.getItem('userId');\r\n    try {\r\n      const res = await fetch(`http://localhost:5000/api/timetable/${userId}`, {\r\n        headers: { 'Authorization': `Bearer ${token}` }\r\n      });\r\n      const data = await res.json();\r\n      setTimetable(data || []);\r\n    } catch {\r\n      setTimetable([]);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  // Now handleDelete can access fetchTimetable and token\r\n  const handleDelete = async (id) => {\r\n    const token = localStorage.getItem('token');\r\n    try {\r\n      const res = await fetch(`http://localhost:5000/api/timetable/${id}`, {\r\n        method: 'DELETE',\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (!res.ok) throw new Error('Failed to delete');\r\n      fetchTimetable();\r\n    } catch (err) {\r\n      console.error(err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchTimetable();\r\n  }, []);\r\n\r\n  // Helper: Find class for a day and time slot\r\n  const getClassForSlot = (day, time) => {\r\n    return timetable.find(\r\n      (item) =>\r\n        (typeof item.day_of_the_week === 'string'\r\n          ? item.day_of_the_week\r\n          : daysOfWeek[item.day_of_the_week]) === day &&\r\n        item.start_time.slice(0, 5) === time\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto p-4\">\r\n      <h2 className=\"text-2xl font-bold mb-6 text-center\">Weekly Timetable</h2>\r\n      {/* PDF Upload Feature */}\r\n      <div className=\"mb-6 flex flex-col items-center\">\r\n        <label className=\"mb-2 font-medium\">Upload Timetable as PDF:</label>\r\n        <div className=\"flex items-center gap-2\">\r\n          <input\r\n            type=\"file\"\r\n            accept=\"application/pdf\"\r\n            onChange={handlePDFUpload}\r\n            ref={fileInputRef}\r\n            className=\"mb-2\"\r\n            disabled={uploading}\r\n          />\r\n          {/* Cancel/Clear button */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleClearFileInput}\r\n            className=\"mb-2 px-2 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-600 text-lg font-bold focus:outline-none\"\r\n            title=\"Clear file input\"\r\n            disabled={uploading}\r\n            style={{ lineHeight: 1 }}\r\n          >\r\n            Ã—\r\n          </button>\r\n        </div>\r\n        {uploading && <span className=\"text-blue-500\">Uploading...</span>}\r\n        {uploadError && <span className=\"text-red-500\">{uploadError}</span>}\r\n      </div>\r\n      {loading ? (\r\n        <p className=\"text-center\">Loading timetable...</p>\r\n      ) : (\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full border-collapse\">\r\n            <thead>\r\n              <tr>\r\n                <th className=\"p-2 border bg-gray-100 dark:bg-[#1E293B]\"></th>\r\n                {daysOfWeek.map((day) => (\r\n                  <th key={day} className=\"p-2 border bg-gray-100 dark:bg-[#1E293B] text-xs md:text-base\">{day}</th>\r\n                ))}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {timeSlots.map((time) => (\r\n                <tr key={time}>\r\n                  <td className=\"p-2 border bg-gray-50 dark:bg-[#1E293B] text-xs md:text-base font-semibold\">{time}</td>\r\n                  {daysOfWeek.map((day) => {\r\n                    const classItem = getClassForSlot(day, time);\r\n                    return (\r\n                      <td key={day + time} className=\"p-1 md:p-2 border align-top\">\r\n                        {classItem ? (\r\n                          <div className=\"bg-blue-100 dark:bg-blue-900 rounded p-1 md:p-2 text-xs md:text-sm shadow\">\r\n                            <div className=\"font-bold\">{classItem.course_name || classItem.activity}</div>\r\n                            <div>{classItem.start_time} - {classItem.end_time}</div>\r\n                            {classItem.location && (\r\n                              <div className=\"text-gray-500\">{classItem.location}</div>\r\n                            )}\r\n                            {classItem.lecturer && (\r\n                              <div className=\"text-gray-400 text-xs\">Lecturer: {classItem.lecturer}</div>\r\n                            )}\r\n                              <button onClick={() => handleDelete(classItem.id)} className=\"text-red-400 text-xs\">Delete</button>\r\n\r\n                          </div>\r\n                        ) : null}\r\n                      </td>\r\n                    );\r\n                  })}\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Timetable;"],"names":["daysOfWeek","timeSlots","Timetable","timetable","setTimetable","useState","loading","setLoading","uploading","setUploading","uploadError","setUploadError","fileInputRef","useRef","fetchTimetable","async","token","localStorage","getItem","userId","res","fetch","headers","Authorization","data","json","useEffect","jsxs","className","children","jsx","type","accept","onChange","e","file","target","files","formData","FormData","append","method","body","ok","Error","message","alert","err","current","value","ref","disabled","onClick","title","style","lineHeight","map","day","time","classItem","find","item","day_of_the_week","start_time","slice","getClassForSlot","course_name","activity","end_time","location","lecturer","id","console","error","handleDelete"],"mappings":"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"}