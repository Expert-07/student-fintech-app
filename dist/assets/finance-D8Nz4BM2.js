import{r as e,j as s}from"./index-CCLVijXR.js";import a from"./Expenses-vsVjd4TR.js";import{j as t}from"./index-CkXcCt97.js";import{u as i,S as n}from"./SideBar-BVdnd6Sp.js";const l=()=>{const[a,t]=e.useState(null),[i,n]=e.useState(null),[l,r]=e.useState({}),[c,o]=e.useState(!0),d=localStorage.getItem("token");e.useEffect(()=>{(async()=>{try{const e=await fetch("http://localhost:5000/api/budget/summary",{headers:{Authorization:`Bearer ${d}`}}),s=await e.json(),a={};Array.isArray(s)&&s.forEach(e=>{e.category&&(a[e.category.toLowerCase().trim()]=e.limit_amount)}),r(a);const[i,l]=await Promise.all([fetch("http://localhost:5000/api/expenses/summary/monthly",{headers:{Authorization:`Bearer ${d}`}}),fetch("http://localhost:5000/api/expenses/summary/weekly",{headers:{Authorization:`Bearer ${d}`}})]),c=await i.json(),o=await l.json();t(c),n(o)}catch(e){console.error("Error fetching summaries or budgets:",e)}finally{o(!1)}})()},[d]);const m=(e,s)=>e&&e.categoryBreakdown?e.categoryBreakdown.map(e=>{const a=parseFloat(e.total),t=e.category?e.category.toLowerCase().trim():"";console.log("Budget categories:",Object.keys(l)),console.log("Checking category:",t,"Original:",e.category);const i=l[t]||0;if(!i||isNaN(i))return`No budget set for ${e.category} in this ${s}.`;const n=a/i*100;return n>100?`⚠️ Overspent on ${e.category} by ₦${(a-i).toFixed(2)} this ${s}.`:n>80?`⚠️ Used ${Math.round(n)}% of your ${e.category} budget this ${s}.`:n<40?`✅ ${e.category} spending is low this ${s}. Great job!`:`ℹ️ ${e.category} is within budget this ${s}.`}):[];return s.jsxs("div",{className:" p-6 w-full max-w-md mx-auto mt-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:"Budget Suggestions"}),c?s.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading..."}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-2 text-xs text-gray-500",children:[s.jsx("strong",{children:"Available budget categories:"})," ",Object.keys(l).join(", ")||"None"]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-100 mb-2",children:"Monthly Overview"}),s.jsx("ul",{className:"space-y-1 list-disc list-inside text-gray-700 dark:text-gray-200",children:m(a,"month").map((e,a)=>s.jsx("li",{children:e},`month-${a}`))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-700 dark:text-gray-100 mb-2",children:"Weekly Overview"}),s.jsx("ul",{className:"space-y-1 list-disc list-inside text-gray-700 dark:text-gray-200",children:m(i,"week").map((e,a)=>s.jsx("li",{children:e},`week-${a}`))})]})]}),s.jsx("div",{className:"budget-cards",children:Array.isArray(Object.entries(l))&&Object.entries(l).length>0&&a&&a.categoryBreakdown&&a.categoryBreakdown.map((e,a)=>{const t=e.category?e.category.toLowerCase().trim():"",i=l[t]||0,n=parseFloat(e.total),r=i>0?Math.min(100,Math.round(n/i*100)):0,c=i-n;let o="",d=null,m="";return c<0?(o=`${Math.abs(r)}% over budget`,d=s.jsx("i",{className:"fas fa-exclamation-triangle me-1 text-danger"}),m="text-danger"):c<=.2*i?(o=`${r}% used`,d=s.jsx("i",{className:"fas fa-exclamation-triangle me-1 text-danger"}),m="text-danger"):(o="On track",d=s.jsx("i",{className:"fas fa-check-circle me-1 text-success"}),m="text-success"),s.jsxs("div",{className:"budget-card fade-in",children:[s.jsxs("div",{className:"budget-header",children:[s.jsx("div",{className:"budget-title",children:e.category}),s.jsxs("div",{className:"budget-amount",children:["₦",Number(i).toLocaleString("en-NG",{minimumFractionDigits:2})]})]}),s.jsxs("div",{className:"progress-container",children:[s.jsxs("div",{className:"progress-info",children:[s.jsxs("span",{children:["Spent: ₦",Number(n).toLocaleString("en-NG",{minimumFractionDigits:2})]}),s.jsxs("span",{children:["Remaining: ₦",Number(c).toLocaleString("en-NG",{minimumFractionDigits:2})]})]}),s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${Math.min(r,100)}%`,background:r>100?"#dc2626":r>80?"#f59e42":"#00ccff"}})})]}),s.jsx("div",{className:`budget-meta ${m}`,children:s.jsxs("span",{children:[d," ",o]})})]},a)})}),s.jsx("div",{className:"section-title",style:{marginTop:"2rem"},children:s.jsxs("h2",{children:[s.jsx("i",{className:"fas fa-bullseye"})," Savings Goals"]})}),s.jsxs("div",{className:"budget-card fade-in",children:[s.jsxs("div",{className:"budget-header",children:[s.jsx("div",{className:"budget-title",children:"New Laptop Fund"}),s.jsx("div",{className:"budget-amount",children:"$500"})]}),s.jsxs("div",{className:"progress-container",children:[s.jsxs("div",{className:"progress-info",children:[s.jsx("span",{children:"Saved: $325"}),s.jsx("span",{children:"Remaining: $175"})]}),s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:"65%"}})})]}),s.jsxs("div",{className:"budget-meta",children:[s.jsxs("span",{children:[s.jsx("i",{className:"fas fa-calendar me-1"})," Target: Aug 30, 2023"]}),s.jsxs("span",{children:[s.jsx("i",{className:"fas fa-coins me-1"})," $35/week"]})]})]})]})},r=["Food & Dining","Transportation","Housing","Entertainment","Education","Shopping","Other"];function c(){const c=e.useRef(null),o=e.useRef(null),[d,m]=e.useState(null),[h,x]=e.useState(null),[u,g]=e.useState(!1),[j,p]=e.useState(""),[N,f]=e.useState(!1),[b,v]=e.useState(""),[y,w]=e.useState(!1),[S,k]=e.useState({category:"",limit_amount:""}),[$,L]=e.useState(!1),[C,F]=e.useState(""),B=e=>{k({...S,[e.target.name]:e.target.value})},{summary:T,loading:A}=i();console.log("Weekly summary:",T),e.useEffect(()=>(document.body.classList.add("finance-bg"),()=>document.body.classList.remove("finance-bg")),[]),e.useEffect(()=>{},[]),e.useEffect(()=>{const e=localStorage.getItem("token");if(!e)return;const s=t(e);x(s.id),E(e)},[]);const E=async e=>{try{const s=await fetch("http://localhost:5000/api/wallet",{headers:{Authorization:`Bearer ${e}`}}),a=await s.json();s.ok?m(a):console.error("Error fetching wallet:",a.message)}catch(s){console.error("Fetch wallet failed:",s)}};return s.jsxs("div",{className:"dashboard-layout",children:[s.jsx(n,{}),s.jsxs("main",{className:"main-content",children:[s.jsxs("header",{className:"dashboard-header",children:[s.jsx("button",{className:"menu-toggle",id:"menuToggle",children:s.jsx("i",{className:"fas fa-bars"})}),s.jsxs("div",{className:"search-bar",id:"searchBar",children:[s.jsx("i",{className:"fas fa-search"}),s.jsx("input",{type:"text",placeholder:"Search transactions..."})]}),s.jsxs("div",{className:"search-profile",children:[s.jsx("button",{className:"search-toggle",id:"searchToggle",children:s.jsx("i",{className:"fas fa-search"})}),s.jsxs("div",{className:"profile-dropdown",children:[s.jsx("div",{className:"notification-badge",children:"3"}),s.jsx("img",{src:"https://ui-avatars.com/api/?name=Alex+Johnson&background=00ffff&color=121212",alt:"Alex"}),s.jsx("span",{children:"Satoru Gojo"}),s.jsx("i",{className:"fas fa-chevron-down"})]})]})]}),s.jsxs("div",{className:"dashboard-content",children:[s.jsxs("div",{className:"welcome-section fade-in",children:[s.jsx("h1",{children:"Finance Tracker"}),s.jsx("p",{children:"Manage your expenses, track your budget, and achieve your financial goals"})]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card fade-in",children:[s.jsx("div",{className:"stat-icon",children:s.jsx("i",{className:"fas fa-wallet"})}),s.jsx("div",{className:"stat-title",children:"Total Balance"}),s.jsxs("div",{className:"stat-value",children:[d?`₦${Number(d.balance).toLocaleString("en-NG",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"Loading...",s.jsx("button",{className:"ml-2 btn btn-xs btn-outline",onClick:()=>g(!0),children:"Top Up"})]}),s.jsxs("div",{className:"stat-subtext",children:[A&&"Loading weekly spend...",!A&&T&&void 0!==T.totalSpent&&s.jsxs("span",{children:["Spent this week: ₦",Number(T.totalSpent).toLocaleString("en-NG",{minimumFractionDigits:2,maximumFractionDigits:2})]}),!A&&(!T||void 0===T.totalSpent)&&s.jsx("span",{children:"Weekly spend unavailable"})]}),u&&s.jsx("div",{className:"modal-overlay",children:s.jsxs("div",{className:"modal-content",children:[s.jsx("h3",{className:"text-lg font-bold mb-2",children:"Top Up Wallet"}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),f(!0),v("");const s=localStorage.getItem("token");try{const e=await fetch("http://localhost:5000/api/wallet/topup",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({amount:Number(j)})}),a=await e.json();if(!e.ok)throw new Error(a.message||"Top-up failed");g(!1),p(""),E(s),alert("Wallet topped up successfully!")}catch(a){v(a.message)}finally{f(!1)}},children:[s.jsx("input",{type:"number",min:"1",className:"w-full p-2 border rounded mb-2",placeholder:"Enter amount (₦)",value:j,onChange:e=>p(e.target.value),required:!0}),b&&s.jsx("div",{className:"text-red-600 mb-2",children:b}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[s.jsx("button",{type:"submit",className:"btn",disabled:N,children:N?"Topping up...":"Top Up"}),s.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>g(!1),children:"Cancel"})]})]})]})})]}),s.jsxs("div",{className:"stat-card fade-in",children:[s.jsx("div",{className:"stat-icon",children:s.jsx("i",{className:"fas fa-arrow-up"})}),s.jsx("div",{className:"stat-title",children:"Monthly Income"}),s.jsx("div",{className:"stat-value",children:"$1,200"}),s.jsx("div",{className:"stat-subtext",children:"From part-time job"})]}),s.jsxs("div",{className:"stat-card fade-in",children:[s.jsx("div",{className:"stat-icon",children:s.jsx("i",{className:"fas fa-arrow-down"})}),s.jsx("div",{className:"stat-title",children:"Monthly Expenses"}),s.jsx("div",{className:"stat-value",children:"$850"}),s.jsx("div",{className:"stat-subtext",children:"- $50 from last month"}),A&&"Loading weekly spend...",!A&&T&&void 0!==T.totalSpent&&s.jsxs("span",{children:["Spent this week: ₦",Number(T.totalSpent).toLocaleString("en-NG",{minimumFractionDigits:2,maximumFractionDigits:2})]}),!A&&(!T||void 0===T.totalSpent)&&s.jsx("span",{children:"Weekly spend unavailable"})]}),s.jsxs("div",{className:"stat-card fade-in",children:[s.jsx("div",{className:"stat-icon",children:s.jsx("i",{className:"fas fa-piggy-bank"})}),s.jsx("div",{className:"stat-title",children:"Savings Rate"}),s.jsx("div",{className:"stat-value",children:"29%"}),s.jsx("div",{className:"stat-subtext",children:"$350 saved this month"})]})]}),s.jsxs("div",{className:"finance-grid",children:[s.jsx(a,{}),s.jsxs("div",{className:"finance-section fade-in",children:[s.jsxs("div",{className:"section-title",children:[s.jsxs("h2",{children:[s.jsx("i",{className:"fas fa-chart-pie"})," Budget Management"]}),s.jsxs("button",{className:"btn",onClick:()=>w(!0),children:[s.jsx("i",{className:"fas fa-plus"})," New Budget"]}),y&&s.jsx("div",{className:"modal-overlay",children:s.jsxs("div",{className:"modal-content",children:[s.jsx("h3",{className:"text-lg font-bold mb-2",children:"Create New Budget"}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),L(!0),F("");const s=localStorage.getItem("token");try{const e=await fetch("http://localhost:5000/api/budget",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({category:S.category,limit_amount:Number(S.limit_amount)})}),a=await e.json();if(!e.ok)throw new Error(a.message||"Failed to create budget");w(!1),k({category:"",limit_amount:""})}catch(a){F(a.message)}finally{L(!1)}},children:[s.jsxs("div",{className:"form-group mb-2",children:[s.jsx("label",{htmlFor:"budgetCategory",children:"Category"}),s.jsxs("select",{id:"budgetCategory",name:"category",value:S.category,onChange:B,required:!0,className:"w-full p-2 border rounded",children:[s.jsx("option",{value:"",children:"Select category"}),r.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{className:"form-group mb-2",children:[s.jsx("label",{htmlFor:"budgetLimit",children:"Limit Amount (₦)"}),s.jsx("input",{type:"number",id:"budgetLimit",name:"limit_amount",value:S.limit_amount,onChange:B,required:!0,className:"w-full p-2 border rounded",min:"0"})]}),C&&s.jsx("div",{className:"text-red-600 mb-2",children:C}),s.jsxs("div",{className:"flex gap-2 mt-4",children:[s.jsx("button",{type:"submit",className:"btn",disabled:$,children:$?"Saving...":"Save Budget"}),s.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>w(!1),children:"Cancel"})]})]})]})})]}),s.jsx(l,{})]}),s.jsxs("div",{className:"finance-section fade-in",children:[s.jsx("div",{className:"section-title",children:s.jsxs("h2",{children:[s.jsx("i",{className:"fas fa-chart-line"})," Financial Analytics"]})}),s.jsxs("div",{className:"chart-container",children:[s.jsxs("div",{className:"chart-header",children:[s.jsx("h3",{children:"Spending by Category"}),s.jsxs("select",{className:"time-filter",children:[s.jsx("option",{children:"This Month"}),s.jsx("option",{children:"Last Month"}),s.jsx("option",{children:"Last 3 Months"})]})]}),s.jsx("canvas",{ref:c,id:"spendingChart"})]}),s.jsxs("div",{className:"chart-container",children:[s.jsxs("div",{className:"chart-header",children:[s.jsx("h3",{children:"Income vs Expenses"}),s.jsxs("select",{className:"time-filter",children:[s.jsx("option",{children:"Last 6 Months"}),s.jsx("option",{children:"Last Year"}),s.jsx("option",{children:"All Time"})]})]}),s.jsx("canvas",{ref:o,id:"incomeExpenseChart"})]})]})]})]})]})]})}export{c as default};
//# sourceMappingURL=finance-D8Nz4BM2.js.map
